# 用户中心模块需求文档

## 1. 角色定义与权限

### 1.1 普通用户

- 使用平台服务的消费者
- 可进行咨询预约、查看个人信息
- 无管理权限

### 1.2 店员

- 提供专业服务的执行者
- 可进行咨询预约、查看个人信息，提供服务
- 无管理权限

### 1.3 管理员(Admin)

- 平台管理者
- 可管理所有用户、订单等
- 拥有最高权限

## 2. 用户认证模块

### 2.1 登录注册功能

- 微信一键登录
  - 获取用户微信头像、昵称等基础信息
  - 获取微信绑定手机号
  - 生成平台唯一用户标识

### 2.2 安全机制

- 登录态维护
  - Token 有效期 7 天
  - 异地登录通知
- 敏感操作验证（需开通短信服务）
  - 修改手机号需验证
  - 大额支付需验证

## 3. 用户信息模块

### 3.1 普通用户信息

#### 基础信息展示

- 头像（支持微信同步/自定义）
- 昵称（2-16 字符）
- 个性签名（最多 50 字符）
- 会员等级展示
- 经验值
- 消费统计
- 优惠券

#### 会员等级体系

> 注：等级体系通过后台字典配置管理，支持动态调整

字典配置项：

- 字典类型：user_level
- 字典说明：用户等级配置
- 配置内容：
  - 等级名称
  - 等级图标
  - 所需经验值
  - 等级权益
  - 标签样式（颜色、渐变色）
  - 排序值
  - 状态（启用/禁用）

默认等级配置：

1. 心灵萌新 (0-500 积分)
2. 心灵知友 (501-2000 积分)
3. 心灵引导者 (2001-5000 积分)
4. 心灵守护者 (5001-10000 积分)
5. 心灵大师 (10000+积分)

#### 升级机制

1. 日常签到获取积分
2. 消费获取积分

### 3.2 店员信息

- 个人照片（轮播）
- 等级
- 头像
- 地区
- 昵称
- 自我介绍
- 服务评分
- 接单统计
- 专业证书（实际上就是标签，比如心理咨询师、情感咨询师等）

#### 等级划分

> 注：等级体系通过后台字典配置管理，支持动态调整

字典配置项：

- 字典类型：staff_level
- 字典说明：店员等级配置
- 配置内容：
  - 等级名称
  - 等级图标
  - 所需经验值
  - 等级权益（如：抽成比例、接单优先级等）
  - 标签样式（颜色、渐变色）
  - 排序值
  - 状态（启用/禁用）

默认等级配置：

1. 心萌新人 (0-100 经验)
2. 情感学徒 (101-500 经验)
3. 情感导师 (501-2000 经验)
4. 心灵导师 (2001-5000 经验)
5. 情感大师 (5000+经验)

#### 升级机制

1. 日常签到获取积分
2. 完成任务获取积分（比如完成一次咨询，获取 100 经验值）
3. 消费获取积分
4. 接单获取积分

## 4. 用户展示模块

### 4.1 客户端店员列表展示

#### 基础信息展示

- 头像
- 昵称
- 地区
- 等级标识（心萌新人/情感学徒/情感导师等）
- 评分（五星制）
- 接单数量
- 好评率

#### 服务信息展示

- 擅长领域标签（如:情感咨询、心理疏导、人际关系等）
- 在线状态（在线/忙碌/离线）
- 预约状态（可预约/已约满）

#### 个性化展示

- 个人简介（限制 100 字）
- 资质认证标识（如有）

#### 互动数据

- 累计服务时长
- 服务人数统计
- 回头率

#### 排序规则

1. 默认按评分和接单量综合排序
2. 可按价格高低排序
3. 可按服务人数排序
4. 可按好评率排序

### 4.2 管理端用户列表

#### 基础功能

- 用户搜索和筛选
  - 按用户 ID 搜索
  - 按手机号搜索
  - 按昵称模糊搜索
  - 按注册时间范围筛选
  - 按用户等级筛选
  - 按用户类型筛选(普通用户/店员)

#### 列表展示信息

- 基础信息

  - 用户 ID
  - 微信 openid
  - 头像
  - 昵称
  - 个性签名
  - 手机号
  - 创建时间
  - 更新时间
  - 用户状态(正常/禁用)

- 用户等级信息

  - 当前等级
  - 经验值
  - 更新时间

- 账户信息

  - 账户余额
  - 累计充值金额
  - 累计消费金额
  - 更新时间
  - 持有优惠券数量

- 店员专属信息(仅店员显示)
  - 接单总数
  - 好评率
  - 累计服务时长
  - 专业领域标签
  - 认证状态

#### 操作功能

- 用户管理

  - 禁用/启用账号
  - 修改用户信息
  - 调整用户等级
  - 查看用户详情

- 账户操作

  - 余额调整
  - 发放优惠券
  - 查看交易记录
  - 查看优惠券记录

- 店员专属操作
  - 审核认证资质
  - 设置专业领域
  - 调整服务价格
  - 查看服务记录

#### 数据导出

- 支持选择字段导出 Excel
- 支持按筛选条件导出
- 导出内容包含基础信息和统计数据

#### 数据统计

- 用户总量统计
- 新增用户趋势
- 用户等级分布
- 用户充值/消费趋势
- 店员服务数据统计

## 4. 数据表设计

### 4.1 用户基础信息表(user_base)

| 字段名          | 类型         | 说明                        |
| --------------- | ------------ | --------------------------- |
| id              | bigint       | 主键自增                    |
| user_id         | varchar(32)  | 用户唯一标识                |
| open_id         | varchar(64)  | 微信 openid                 |
| union_id        | varchar(64)  | 微信 unionid                |
| nickname        | varchar(32)  | 用户昵称                    |
| avatar          | varchar(255) | 头像 URL                    |
| signature       | varchar(100) | 个性签名                    |
| mobile          | varchar(11)  | 手机号                      |
| user_type       | tinyint      | 用户类型(1 普通用户 2 店员) |
| status          | tinyint      | 状态(0 禁用 1 正常)         |
| create_time     | datetime     | 创建时间                    |
| update_time     | datetime     | 更新时间                    |
| last_login_time | datetime     | 最后登录时间                |
| deleted         | tinyint      | 是否删除(0 否 1 是)         |

### 4.2 用户等级表(user_level)

| 字段名      | 类型        | 说明                                |
| ----------- | ----------- | ----------------------------------- |
| id          | bigint      | 主键自增                            |
| user_id     | varchar(32) | 用户唯一标识                        |
| level       | tinyint     | 等级                                |
| exp         | int         | 经验值                              |
| level_type  | tinyint     | 等级类型(1 普通用户等级 2 店员等级) |
| update_time | datetime    | 更新时间                            |
| deleted     | tinyint     | 是否删除(0 否 1 是)                 |

### 4.3 用户钱包表(user_wallet)

| 字段名         | 类型          | 说明                |
| -------------- | ------------- | ------------------- |
| id             | bigint        | 主键自增            |
| user_id        | varchar(32)   | 用户唯一标识        |
| balance        | decimal(10,2) | 余额                |
| frozen_balance | decimal(10,2) | 冻结余额            |
| total_recharge | decimal(10,2) | 总充值              |
| total_consume  | decimal(10,2) | 总消费              |
| update_time    | datetime      | 更新时间            |
| version        | int           | 乐观锁版本号        |
| deleted        | tinyint       | 是否删除(0 否 1 是) |

### 4.4 优惠券表(user_coupon)

| 字段名      | 类型          | 说明                                 |
| ----------- | ------------- | ------------------------------------ |
| id          | bigint        | 主键自增                             |
| coupon_id   | varchar(32)   | 优 ��� 券唯一标识                    |
| user_id     | varchar(32)   | 用户唯一标识                         |
| type        | tinyint       | 优惠券类型(1 满减 2 折扣)            |
| amount      | decimal(10,2) | 优惠金额                             |
| discount    | decimal(4,2)  | 折扣率(0-100)                        |
| min_amount  | decimal(10,2) | 使用门槛                             |
| status      | tinyint       | 使用状态(0 未使用 1 已使用 2 已过期) |
| valid_start | datetime      | 有效期开始                           |
| valid_end   | datetime      | 有效期结束                           |
| create_time | datetime      | 创建时间                             |
| update_time | datetime      | 更新时间                             |
| deleted     | tinyint       | 是否删除(0 否 1 是)                  |

### 4.5 店员信息表(staff_info)

| 字段名         | 类型         | 说明                                   |
| -------------- | ------------ | -------------------------------------- |
| id             | bigint       | 主键自增                               |
| user_id        | varchar(32)  | 用户唯一标识                           |
| photos         | text         | 个人照片(JSON 数组)                    |
| region         | varchar(50)  | �� 区                                  |
| introduction   | varchar(500) | 自我介绍                               |
| service_score  | decimal(2,1) | 服务评分                               |
| order_count    | int          | 接单总数                               |
| good_rate      | decimal(4,1) | 好评率                                 |
| service_time   | int          | 累计服务时长(分钟)                     |
| certificates   | text         | 专业证书(JSON 数组)                    |
| online_status  | tinyint      | 在线状态(0 离线 1 在线 2 忙碌)         |
| booking_status | tinyint      | 预约状态(0 可预约 1 已约满)            |
| verify_status  | tinyint      | 认证状态(0 未认证 1 已认证 2 认证失败) |
| create_time    | datetime     | 创建时间                               |
| update_time    | datetime     | 更新时间                               |
| deleted        | tinyint      | 是否删除(0 否 1 是)                    |

### 4.6 店员服务项目表(staff_service)

| 字段名       | 类型          | 说明                |
| ------------ | ------------- | ------------------- |
| id           | bigint        | 主键自增            |
| user_id      | varchar(32)   | 店员用户 ID         |
| service_name | varchar(50)   | 服务名称            |
| price        | decimal(10,2) | 服务价格            |
| description  | varchar(500)  | 服务描述            |
| status       | tinyint       | 状态(0 下架 1 上架) |
| create_time  | datetime      | 创建时间            |
| update_time  | datetime      | 更新时间            |
| deleted      | tinyint       | 是否删除(0 否 1 是) |

### 4.7 系统字典表(sys_dict)

| 字段名      | 类型         | 说明                |
| ----------- | ------------ | ------------------- |
| id          | bigint       | 主键自增            |
| dict_type   | varchar(50)  | 字典类型            |
| dict_name   | varchar(100) | 字典名称            |
| dict_desc   | varchar(255) | 字典描述            |
| status      | tinyint      | 状态(0 禁用 1 正常) |
| create_time | datetime     | 创建时间            |
| update_time | datetime     | 更新时间            |
| deleted     | tinyint      | 是否删除(0 否 1 是) |

### 4.8 系统字典项表(sys_dict_item)

| 字段名      | 类型         | 说明                |
| ----------- | ------------ | ------------------- |
| id          | bigint       | 主键自增            |
| dict_type   | varchar(50)  | 字典类型            |
| item_value  | varchar(100) | 字典项值            |
| item_label  | varchar(100) | 字典项标签          |
| item_desc   | varchar(255) | 字典项描述          |
| item_sort   | int          | 排序号              |
| item_extra  | text         | 扩展信息(JSON 格式) |
| status      | tinyint      | 状态(0 禁用 1 正常) |
| create_time | datetime     | 创建时间            |
| update_time | datetime     | 更新时间            |
| deleted     | tinyint      | 是否删除(0 否 1 是) |
